import plotly.graph_objs as go
import numpy as np
from pymongo import MongoClient

import sendgrid
import os
from sendgrid.helpers.mail import *


def send_email(to_email, nombres, nit, key_pass, file_email="./templates/email.html"):

    emailcontent=open(file_email, 'r')
    emailcontenttxt=emailcontent.read()
    #emailcontenttxt=''.join(emailcontenttxt)
    emailcontenttxt=emailcontenttxt.replace("NOMBRE EMPLEADO!", nombres)
    emailcontenttxt=emailcontenttxt.replace("nit_ips", str(nit))
    emailcontenttxt=emailcontenttxt.replace("key_pass", str(key_pass))
    sg = sendgrid.SendGridAPIClient(apikey=os.environ.get('SENDGRID_API_KEY'))
    from_email = Email("no_responder@encuesta_tic.com")
    to_email = Email(to_email)
    subject = " Estudio sobre el nivel de madurez del ecosistema de TIC en las IPS públicas "
    content = Content("text/html", (emailcontenttxt))
    mail = Mail(from_email, subject, to_email, content)
    response = sg.client.mail.send.post(request_body=mail.get())
    print(response.status_code)
    print(response.body)
    print(response.headers)


def remove_db(name_db):
    client=MongoClient()
    client.drop_database(name_db)


def get_data_map(lati, longi, sizem, textm, nivel, mapbox_access_token):
    #print(textm)
    latl=[]
    longl=[]
    sizel=[]
    textl=[]
    lati=np.asarray(lati)
    longi=np.asarray(longi)
    sizem=np.asarray(sizem)

    for j in np.unique(nivel):

        pos=np.where(nivel==j)[0]
        latl.append(lati[pos])
        longl.append(longi[pos])
        sizel.append(sizem[pos])
        textl.append([textm[k] for k in pos])

    colorlist=['rgba(69,124,235, 0.7)', 'rgba(235,69,69, 0.7)', 'rgba(235,124,69, 0.7)']
    datamap = go.Data([
        go.Scattermapbox(
            lat=latl[j],
            lon=longl[j],
            mode='markers',
            name='IPS Nivel '+str(j),
            marker=go.Marker(size=sizel[j],
            color=colorlist[j],
            ),
            text=textl[j],
        )
    for j in range(len(np.unique(nivel)))] )

    layoutmap = go.Layout(
        title="Estado de conectividad de IPS públicas en Colombia",
        hovermode='closest',
        autosize=False,
        width='30%',
        height=800,
        mapbox=dict(
            accesstoken=mapbox_access_token,
            bearing=0,
            center=dict(
                lat=4.6,
                lon=-74.09
            ),
            domain=dict(
                    x=[0,1],
                    y=[0,1]
                ),
            pitch=0,
            style='light',
            zoom=4.5
        ),
    )
    return datamap, layoutmap


def get_radar(ref, val, legends, refdpto=[0,0,0,0,0,0]):

    n_ind=len(ref)-1

    t=np.arange(0,2*np.pi+2*np.pi/n_ind,2*np.pi/n_ind),

    yref=ref*np.cos(t)
    xref=ref*np.sin(t)
    yrefdpto=refdpto*np.cos(t)
    xrefdpto=refdpto*np.sin(t)
    yval=val*np.cos(t)
    xval=val*np.sin(t)

    r_text=1*np.ones(len(ref))
    ytext=r_text*np.cos(t)
    xtext=r_text*np.sin(t)

    print(xref, yref)

    trace1 = {"type": "scatter"}
    trace2 = {
      "x": [0, 0],
      "y": [1, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace3 = {
      "x": [0.258819045103, 0],
      "y": [0.965925826289, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace4 = {
      "x": [0.5, 0],
      "y": [0.866025403784, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace5 = {
      "x": [0.707106781187, 0],
      "y": [0.707106781187, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace6 = {
      "x": [0.866025403784, 0],
      "y": [0.5, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace7 = {
      "x": [0.965925826289, 0],
      "y": [0.258819045103, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace8 = {
      "x": [1, 0],
      "y": [6.12323399574e-17, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace9 = {
      "x": [0.965925826289, 0],
      "y": [-0.258819045103, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace10 = {
      "x": [0.866025403784, 0],
      "y": [-0.5, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace11 = {
      "x": [0.707106781187, 0],
      "y": [-0.707106781187, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace12 = {
      "x": [0.5, 0],
      "y": [-0.866025403784, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace13 = {
      "x": [0.258819045103, 0],
      "y": [-0.965925826289, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace14 = {
      "x": [1.22464679915e-16, 0],
      "y": [-1, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace15 = {
      "x": [-0.258819045103, 0],
      "y": [-0.965925826289, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace16 = {
      "x": [-0.5, 0],
      "y": [-0.866025403784, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace17 = {
      "x": [-0.707106781187, 0],
      "y": [-0.707106781187, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace18 = {
      "x": [-0.866025403784, 0],
      "y": [-0.5, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace19 = {
      "x": [-0.965925826289, 0],
      "y": [-0.258819045103, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace20 = {
      "x": [-1, 0],
      "y": [-1.83697019872e-16, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace21 = {
      "x": [-0.965925826289, 0],
      "y": [0.258819045103, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace22 = {
      "x": [-0.866025403784, 0],
      "y": [0.5, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace23 = {
      "x": [-0.707106781187, 0],
      "y": [0.707106781187, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace24 = {
      "x": [-0.5, 0],
      "y": [0.866025403784, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace25 = {
      "x": [-0.258819045103, 0],
      "y": [0.965925826289, 0],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px"
      },
      "showlegend": False,
      "type": "scatter"
    }
    trace26 = {
      "x": xref[0],#[0, 0.124233141649, 0.165, 0.247487373415, 0.407031939779, 0.289777747887, 0.43, 0.280118489624, 0.311769145362, 0.268700576851, 0.225, 0.0828220944328, 3.3065463577e-17, -0.0569401899226, -0.13, -0.671751442127, -0.493634480157, -0.405688847041, -0.38, -0.482962913145, -0.268467875173, -0.219203102168, -0.06, -0.22776075969, 0],
      "y": yref[0],#[0.54, 0.463644396619, 0.285788383249, 0.247487373415, 0.235, 0.0776457135308, 2.63299061817e-17, -0.0750575230797, -0.18, -0.268700576851, -0.389711431703, -0.309096264413, -0.27, -0.212503681784, -0.225166604984, -0.671751442127, -0.285, -0.108703998943, -6.98048675514e-17, 0.129409522551, 0.155, 0.219203102168, 0.103923048454, 0.850014727134, 0.54],
      #"x": [0, 0.124233141649, 0.165, 0.247487373415, 0.407031939779, 0.289777747887, 0.43, 0.280118489624, 0.311769145362, 0.268700576851, 0.225, 0.0828220944328, 3.3065463577e-17, -0.0569401899226, -0.13, -0.671751442127, -0.493634480157, -0.405688847041, -0.38, -0.482962913145, -0.268467875173, -0.219203102168, -0.06, -0.22776075969, 0],
      #"y": [0.54, 0.463644396619, 0.285788383249, 0.247487373415, 0.235, 0.0776457135308, 2.63299061817e-17, -0.0750575230797, -0.18, -0.268700576851, -0.389711431703, -0.309096264413, -0.27, -0.212503681784, -0.225166604984, -0.671751442127, -0.285, -0.108703998943, -6.98048675514e-17, 0.129409522551, 0.155, 0.219203102168, 0.103923048454, 0.850014727134, 0.54],

      "hoverinfo": "text",
      "marker": {"color":'rgba(69,124,235, 0.5)', "size":15, "line": dict(width = 6, color='rgba(240,240,240, 0.5)')},

      "showlegend": False,
      "mode": "markers",
      "name": "Referencia",
      "text": ["Referencia: "+legends[j]+" "+str(ref[j]) for j in range(len(ref))],
      "type": "scatter"
    }

    trace26b = {
      "x": xref[0],#[0, 0.124233141649, 0.165, 0.247487373415, 0.407031939779, 0.289777747887, 0.43, 0.280118489624, 0.311769145362, 0.268700576851, 0.225, 0.0828220944328, 3.3065463577e-17, -0.0569401899226, -0.13, -0.671751442127, -0.493634480157, -0.405688847041, -0.38, -0.482962913145, -0.268467875173, -0.219203102168, -0.06, -0.22776075969, 0],
      "y": yref[0],#[0.54, 0.463644396619, 0.285788383249, 0.247487373415, 0.235, 0.0776457135308, 2.63299061817e-17, -0.0750575230797, -0.18, -0.268700576851, -0.389711431703, -0.309096264413, -0.27, -0.212503681784, -0.225166604984, -0.671751442127, -0.285, -0.108703998943, -6.98048675514e-17, 0.129409522551, 0.155, 0.219203102168, 0.103923048454, 0.850014727134, 0.54],
      #"x": [0, 0.124233141649, 0.165, 0.247487373415, 0.407031939779, 0.289777747887, 0.43, 0.280118489624, 0.311769145362, 0.268700576851, 0.225, 0.0828220944328, 3.3065463577e-17, -0.0569401899226, -0.13, -0.671751442127, -0.493634480157, -0.405688847041, -0.38, -0.482962913145, -0.268467875173, -0.219203102168, -0.06, -0.22776075969, 0],
      #"y": [0.54, 0.463644396619, 0.285788383249, 0.247487373415, 0.235, 0.0776457135308, 2.63299061817e-17, -0.0750575230797, -0.18, -0.268700576851, -0.389711431703, -0.309096264413, -0.27, -0.212503681784, -0.225166604984, -0.671751442127, -0.285, -0.108703998943, -6.98048675514e-17, 0.129409522551, 0.155, 0.219203102168, 0.103923048454, 0.850014727134, 0.54],
      "hoverinfo": "text",
      "marker": {"color":'rgba(69,124,235, 0.5)', "size":20, "line": dict(width = 6, color='rgba(240,240,240, 0.5)')},
      "mode": "lines",
      "name": "Referencia",
      "text": ["Referencia: "+legends[j]+" "+str(ref[j]) for j in range(len(ref))],
      "type": "scatter"
    }

    trace27 = {
      "x": xval[0],#[0, 0.142350474806, 0.155, 0.282842712475, 0.433012701892, 0.328414780938, 0.53, 0.289777747887, 0.355070415552, 0.289913780286, 0.23, 0.0879984753349, 2.69422295812e-17, -0.0439992376674, -0.14, -0.664680374315, -0.536935750346, -0.444325880093, -0.41, -0.511940687933, -0.294448637287, -0.254558441227, -0.05, -0.217407997886, 0],
      "y": yval[0],#[0.55, 0.531259204459, 0.268467875173, 0.282842712475, 0.25, 0.0879984753349, 3.24531401774e-17, -0.0776457135308, -0.205, -0.289913780286, -0.398371685741, -0.328414780938, -0.22, -0.164207390469, -0.24248711306, -0.664680374315, -0.31, -0.119056760747, -7.53157781476e-17, 0.137174093904, 0.17, 0.254558441227, 0.0866025403784, 0.811377694083, 0.55],
      "hoverinfo": "text",
      "marker": {"color": 'rgba(255,78,252, 0.5)', "size":15, "line": dict(width = 6, color='rgba(240,240,240, 0.5)')},
      "mode": "markers",
      "showlegend": False,
      "text": ["IPS seleccionada: "+legends[j]+" "+str(val[j]) for j in range(len(val))],
      "type": "scatter"
    }
    trace27b = {
          "x": xval[0],#[0, 0.142350474806, 0.155, 0.282842712475, 0.433012701892, 0.328414780938, 0.53, 0.289777747887, 0.355070415552, 0.289913780286, 0.23, 0.0879984753349, 2.69422295812e-17, -0.0439992376674, -0.14, -0.664680374315, -0.536935750346, -0.444325880093, -0.41, -0.511940687933, -0.294448637287, -0.254558441227, -0.05, -0.217407997886, 0],
          "y": yval[0],#[0.55, 0.531259204459, 0.268467875173, 0.282842712475, 0.25, 0.0879984753349, 3.24531401774e-17, -0.0776457135308, -0.205, -0.289913780286, -0.398371685741, -0.328414780938, -0.22, -0.164207390469, -0.24248711306, -0.664680374315, -0.31, -0.119056760747, -7.53157781476e-17, 0.137174093904, 0.17, 0.254558441227, 0.0866025403784, 0.811377694083, 0.55],
          "hoverinfo": "text",
          "marker": {"color": 'rgba(255,78,252, 0.5)', "size":20, "line": dict(width = 6, color='rgba(240,240,240, 0.5)')},
          "mode": "lines",
          "name": "IPS seleccionada",
          "text": ["IPS seleccionada: "+legends[j]+" "+str(val[j]) for j in range(len(val))],
          "type": "scatter"
        }

    trace28 = {
      "x":xtext[0],#[0, 0.258819045103, 0.5, 0.707106781187, 0.866025403784, 0.965925826289, 1, 0.965925826289, 0.866025403784, 0.707106781187, 0.5, 0.258819045103, 1.22464679915e-16, -0.258819045103, -0.5, -0.707106781187, -0.866025403784, -0.965925826289, -1, -0.965925826289, -0.866025403784, -0.707106781187, -0.5, -0.258819045103, 0, 0.258819045103, 0.5, 0.707106781187, 0.866025403784, 0.965925826289, 1, 0.965925826289, 0.866025403784, 0.707106781187, 0.5, 0.258819045103, 1.22464679915e-16, -0.258819045103, -0.5, -0.707106781187, -0.866025403784, -0.965925826289, -1, -0.965925826289, -0.866025403784, -0.707106781187, -0.5, -0.258819045103],
      "y": ytext[0],#[1, 0.965925826289, 0.866025403784, 0.707106781187, 0.5, 0.258819045103, 6.12323399574e-17, -0.258819045103, -0.5, -0.707106781187, -0.866025403784, -0.965925826289, -1, -0.965925826289, -0.866025403784, -0.707106781187, -0.5, -0.258819045103, -1.83697019872e-16, 0.258819045103, 0.5, 0.707106781187, 0.866025403784, 0.965925826289, 1, 0.965925826289, 0.866025403784, 0.707106781187, 0.5, 0.258819045103, 6.12323399574e-17, -0.258819045103, -0.5, -0.707106781187, -0.866025403784, -0.965925826289, -1, -0.965925826289, -0.866025403784, -0.707106781187, -0.5, -0.258819045103, -1.83697019872e-16, 0.258819045103, 0.5, 0.707106781187, 0.866025403784, 0.965925826289],

      "hoverinfo": "none",
      "line": {
        "color": "#d3d3d3",
        "dash": "3px",
        "shape": "spline"
      },
      "mode": "lines+text",
      "showlegend": False,
      "text":legends,
      "textposition": "top middle",
      "type": "scatter"
    }
    trace29 = {
      "x": [0, 0.129409522551, 0.25, 0.353553390593, 0.433012701892, 0.482962913145, 0.5, 0.482962913145, 0.433012701892, 0.353553390593, 0.25, 0.129409522551, 6.12323399574e-17, -0.129409522551, -0.25, -0.353553390593, -0.433012701892, -0.482962913145, -0.5, -0.482962913145, -0.433012701892, -0.353553390593, -0.25, -0.129409522551, 0, 0.129409522551, 0.25, 0.353553390593, 0.433012701892, 0.482962913145, 0.5, 0.482962913145, 0.433012701892, 0.353553390593, 0.25, 0.129409522551, 6.12323399574e-17, -0.129409522551, -0.25, -0.353553390593, -0.433012701892, -0.482962913145, -0.5, -0.482962913145, -0.433012701892, -0.353553390593, -0.25, -0.129409522551],
      "y": [0.5, 0.482962913145, 0.433012701892, 0.353553390593, 0.25, 0.129409522551, 3.06161699787e-17, -0.129409522551, -0.25, -0.353553390593, -0.433012701892, -0.482962913145, -0.5, -0.482962913145, -0.433012701892, -0.353553390593, -0.25, -0.129409522551, -9.18485099361e-17, 0.129409522551, 0.25, 0.353553390593, 0.433012701892, 0.482962913145, 0.5, 0.482962913145, 0.433012701892, 0.353553390593, 0.25, 0.129409522551, 3.06161699787e-17, -0.129409522551, -0.25, -0.353553390593, -0.433012701892, -0.482962913145, -0.5, -0.482962913145, -0.433012701892, -0.353553390593, -0.25, -0.129409522551, -9.18485099361e-17, 0.129409522551, 0.25, 0.353553390593, 0.433012701892, 0.482962913145],
      "hoverinfo": "none",
      "line": {
        "color": "#d3d3d3",
        "dash": "3px",
        "shape": "spline"
      },
      "mode": "lines",
      "showlegend": False,
      "type": "scatter"
    }
    trace30 = {
      "x": [0, 0.194114283827, 0.375, 0.53033008589, 0.649519052838, 0.724444369717, 0.75, 0.724444369717, 0.649519052838, 0.53033008589, 0.375, 0.194114283827, 9.18485099361e-17, -0.194114283827, -0.375, -0.53033008589, -0.649519052838, -0.724444369717, -0.75, -0.724444369717, -0.649519052838, -0.53033008589, -0.375, -0.194114283827, 0, 0.194114283827, 0.375, 0.53033008589, 0.649519052838, 0.724444369717, 0.75, 0.724444369717, 0.649519052838, 0.53033008589, 0.375, 0.194114283827, 9.18485099361e-17, -0.194114283827, -0.375, -0.53033008589, -0.649519052838, -0.724444369717, -0.75, -0.724444369717, -0.649519052838, -0.53033008589, -0.375, -0.194114283827],
      "y": [0.75, 0.724444369717, 0.649519052838, 0.53033008589, 0.375, 0.194114283827, 4.5924254968e-17, -0.194114283827, -0.375, -0.53033008589, -0.649519052838, -0.724444369717, -0.75, -0.724444369717, -0.649519052838, -0.53033008589, -0.375, -0.194114283827, -1.37772764904e-16, 0.194114283827, 0.375, 0.53033008589, 0.649519052838, 0.724444369717, 0.75, 0.724444369717, 0.649519052838, 0.53033008589, 0.375, 0.194114283827, 4.5924254968e-17, -0.194114283827, -0.375, -0.53033008589, -0.649519052838, -0.724444369717, -0.75, -0.724444369717, -0.649519052838, -0.53033008589, -0.375, -0.194114283827, -1.37772764904e-16, 0.194114283827, 0.375, 0.53033008589, 0.649519052838, 0.724444369717],
      "line": {
        "color": "#d3d3d3",
        "dash": "3px",
        "shape": "spline"
      },
      "hoverinfo": "none",
      "mode": "lines",
      "showlegend": False,
      "type": "scatter"
    }

    trace31 = {
      "x": xrefdpto[0],#[0, 0.124233141649, 0.165, 0.247487373415, 0.407031939779, 0.289777747887, 0.43, 0.280118489624, 0.311769145362, 0.268700576851, 0.225, 0.0828220944328, 3.3065463577e-17, -0.0569401899226, -0.13, -0.671751442127, -0.493634480157, -0.405688847041, -0.38, -0.482962913145, -0.268467875173, -0.219203102168, -0.06, -0.22776075969, 0],
      "y": yrefdpto[0],#[0.54, 0.463644396619, 0.285788383249, 0.247487373415, 0.235, 0.0776457135308, 2.63299061817e-17, -0.0750575230797, -0.18, -0.268700576851, -0.389711431703, -0.309096264413, -0.27, -0.212503681784, -0.225166604984, -0.671751442127, -0.285, -0.108703998943, -6.98048675514e-17, 0.129409522551, 0.155, 0.219203102168, 0.103923048454, 0.850014727134, 0.54],
      #"x": [0, 0.124233141649, 0.165, 0.247487373415, 0.407031939779, 0.289777747887, 0.43, 0.280118489624, 0.311769145362, 0.268700576851, 0.225, 0.0828220944328, 3.3065463577e-17, -0.0569401899226, -0.13, -0.671751442127, -0.493634480157, -0.405688847041, -0.38, -0.482962913145, -0.268467875173, -0.219203102168, -0.06, -0.22776075969, 0],
      #"y": [0.54, 0.463644396619, 0.285788383249, 0.247487373415, 0.235, 0.0776457135308, 2.63299061817e-17, -0.0750575230797, -0.18, -0.268700576851, -0.389711431703, -0.309096264413, -0.27, -0.212503681784, -0.225166604984, -0.671751442127, -0.285, -0.108703998943, -6.98048675514e-17, 0.129409522551, 0.155, 0.219203102168, 0.103923048454, 0.850014727134, 0.54],

      "hoverinfo": "text",
      "marker": {"color":'rgba(69,235,124, 0.5)', "size":15, "line": dict(width = 6, color='rgba(240,240,240, 0.5)')},

      "showlegend": False,
      "mode": "markers",
      "name": "Referencia Departamental",
      "text": ["Referencia Departamental: "+legends[j]+" "+str(ref[j]) for j in range(len(ref))],
      "type": "scatter"
    }

    trace31b = {
      "x": xrefdpto[0],#[0, 0.124233141649, 0.165, 0.247487373415, 0.407031939779, 0.289777747887, 0.43, 0.280118489624, 0.311769145362, 0.268700576851, 0.225, 0.0828220944328, 3.3065463577e-17, -0.0569401899226, -0.13, -0.671751442127, -0.493634480157, -0.405688847041, -0.38, -0.482962913145, -0.268467875173, -0.219203102168, -0.06, -0.22776075969, 0],
      "y": yrefdpto[0],#[0.54, 0.463644396619, 0.285788383249, 0.247487373415, 0.235, 0.0776457135308, 2.63299061817e-17, -0.0750575230797, -0.18, -0.268700576851, -0.389711431703, -0.309096264413, -0.27, -0.212503681784, -0.225166604984, -0.671751442127, -0.285, -0.108703998943, -6.98048675514e-17, 0.129409522551, 0.155, 0.219203102168, 0.103923048454, 0.850014727134, 0.54],
      #"x": [0, 0.124233141649, 0.165, 0.247487373415, 0.407031939779, 0.289777747887, 0.43, 0.280118489624, 0.311769145362, 0.268700576851, 0.225, 0.0828220944328, 3.3065463577e-17, -0.0569401899226, -0.13, -0.671751442127, -0.493634480157, -0.405688847041, -0.38, -0.482962913145, -0.268467875173, -0.219203102168, -0.06, -0.22776075969, 0],
      #"y": [0.54, 0.463644396619, 0.285788383249, 0.247487373415, 0.235, 0.0776457135308, 2.63299061817e-17, -0.0750575230797, -0.18, -0.268700576851, -0.389711431703, -0.309096264413, -0.27, -0.212503681784, -0.225166604984, -0.671751442127, -0.285, -0.108703998943, -6.98048675514e-17, 0.129409522551, 0.155, 0.219203102168, 0.103923048454, 0.850014727134, 0.54],
      "hoverinfo": "text",
      "marker": {"color":'rgba(69,235,124, 0.5)', "size":20, "line": dict(width = 6, color='rgba(240,240,240, 0.5)')},
      "mode": "lines",
      "name": "Referencia Departamental",
      "text": ["Referencia Departamental: "+legends[j]+" "+str(ref[j]) for j in range(len(ref))],
      "type": "scatter"
    }

    data = go.Data([trace1, trace2, trace3, trace4, trace5, trace6, trace7, trace8, trace9, trace10, trace11, trace12, trace13, trace14, trace15, trace16, trace17, trace18, trace19, trace20, trace21, trace22, trace23, trace24, trace25, trace26, trace26b, trace27, trace27b, trace28, trace29, trace30, trace31, trace31b])
    layout = {
      "legend" : dict(x = -0.1, y = 0.1, bgcolor = "transparent"),

      "autosize": False,
      "height": 700,
      "hovermode": "closest",
      "width": "40%",
      #"title":"Conectividad de su IPS",

      "xaxis": {
        "range": [-1.4, 1.4],
        "showgrid": False,
        "showticklabels": False,
        "zeroline": False
      },
      "yaxis": {
        "range": [-1.4, 1.4],
        "showgrid": False,
        "showticklabels": False,
        "zeroline": False
      },
      "margin": go.Margin(
        l=0,
        r=0,
        b=100,
        t=0,
        pad=0
    ),
    }


    return data, layout




def compute_indicator_map(docs):

    axis1=docs["Respuestas"]["p2"]/4
    axis2=docs["Respuestas"]["p4"]/5
    axis3=docs["Respuestas"]["p5"]/5
    axis4=docs["Respuestas"]["p6"]/5
    axis5=docs["Respuestas"]["p7"]/5
    nivel=docs["Nivel"]
    name=docs["IPS"]
    data_ips=np.hstack([axis1, axis2, axis3, axis4, axis5, axis1]).mean()

    return name, data_ips, nivel
